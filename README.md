# 나혼자 먹는다

<p align="center">

![eating_alone_mainlogo9](https://github.com/user-attachments/assets/6f3b40ac-b943-471d-9cb6-0191ed7387d1)

</p>

## 프로젝트 정보

> 네이버 클라우드 데브옵스 3기 4조 - 세미 프로젝트<br>개발기간: 2023.12.04 - 2023.12.26

### 발표 자료

[발표 자료 PPT](https://acrobat.adobe.com/id/urn:aaid:sc:AP:bb643b30-9ca3-4eb0-b1ac-c4920629c187)

---

## 팀원 소개

![contributors](https://github.com/user-attachments/assets/270de4e1-ab93-446b-b964-b092f8c59228)

---

## 프로젝트 소개

<나혼자 먹는다>는 자취생들이 서로 레시피를 제공하고 공유하고, 중고 거래 관련 커뮤니티 활동을 할 수 있도록 제작한 커뮤니티 기반 프로젝트입니다. 데브옵스 수업에서 학습한 Maven Project를 복습하며 활용하였습니다.

---

## 기술 스택

### Environment

<img src="https://img.shields.io/badge/Eclipse-2C2255?style=for-the-badge&logo=EclipseIDE&logoColor=white"> <img src="https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=Git&logoColor=white"> <img src="https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=GitHub&logoColor=white">

### Front-End

<img src="https://img.shields.io/badge/HTML5-E34F29?style=for-the-badge&logo=HTML5&logoColor=white"> <img src="https://img.shields.io/badge/CSS3-1572B6?style=for-the-badge&logo=CSS3&logoColor=white"> <img src="https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&logo=JavaScript&logoColor=white"> <img src="https://img.shields.io/badge/Bootstrap-7952B3?style=for-the-badge&logo=Bootstrap&logoColor=white"> <img src="https://img.shields.io/badge/jQuery-0769AD?style=for-the-badge&logo=jQuery&logoColor=white">

### Back-End

[![Java](https://img.shields.io/badge/Java-007396?style=for-the-badge&logo=java&logoColor=white)](https://www.java.com/) <img src="https://img.shields.io/badge/Spring Framework-6DB33F?style=for-the-badge&logo=Spring&logoColor=white"> [![MyBatis](https://img.shields.io/badge/MyBatis-000000?style=for-the-badge&logo=mybatis&logoColor=white)](https://mybatis.org/)

### Server & Publish

<img src="https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=Docker&logoColor=white"> <img src="https://img.shields.io/badge/Jenkins-D24939?style=for-the-badge&logo=Jenkins&logoColor=white"> <img src="https://img.shields.io/badge/Apache Tomcat 9-F8DC75?style=for-the-badge&logo=ApacheTomcat&logoColor=black"> <img src="https://img.shields.io/badge/Naver Cloud-03C75A?style=for-the-badge&logo=Naver&logoColor=white">

### Database

<img src="https://img.shields.io/badge/MySQL-4479A1?style=for-the-badge&logo=MySQL&logoColor=white">

### Communication

<img src="https://img.shields.io/badge/Slack-4A154B?style=for-the-badge&logo=Slack&logoColor=white"> <img src="https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=Notion&logoColor=white">

---

## 페이지 구성

<details>
  <summary><b>홈 화면</b></summary>
  <br>
  <table>
    <tr>
      <td align=center>
        <b>홈 화면</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/4be86494-d839-4c6d-a7f7-ac5c3b9ed0e4">
      </td>
    </tr>
  </table>
</details>

<details>
  <summary><b>레시피 화면</b></summary>
  <br>
  <table>
    <tr>
      <td align=center>
        <b>그리드1</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/d3b84353-80d1-4e81-ab2c-bac58ebf07ae">
      </td>
    </tr>
    <tr>
      <td align=center>
        <b>그리드2</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/dc8f4fab-f783-4762-ae0c-02ca617c7335">
      </td>
    </tr>
    <tr>
      <td align=center>
        <b>검색</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/d3b95a71-96bc-47eb-ae14-945d81bca683">
      </td>
    </tr>
    <tr>
      <td align=center>
        <b>글 작성</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/aae00043-1ccb-4669-a8f8-7ae4402f7d4b">
      </td>
    </tr>
    <tr>
      <td align=center>
        <b>글 수정/삭제</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/31c0bfc8-dd6b-4fd2-b6f6-fbf82f2c1468">
      </td>
    </tr>
    <tr>
      <td align=center>
        <b>상세 페이지</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/167774a8-9e62-4230-b48e-f5d4f5a9de1b">
      </td>
    </tr>
  </table>
</details>

<details>
  <summary><b>커뮤니티 화면</b></summary>
  <br>
  <table>
    <tr>
      <td align=center>
        <b>커뮤니티 화면</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/32933c0d-f3a0-41cd-9ea8-eedcbabb641b">
      </td>
    </tr>
    <tr>
      <td align=center>
        <b>글 작성</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/b0b338e9-9c9d-4cc3-add0-1d53e959646a">
      </td>
    </tr>
    <tr>
      <td align=center>
        <b>글 수정/삭제</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/c2e5008d-0a6e-4666-9896-957ebf894925">
      </td>
    </tr>
    <tr>
      <td align=center>
        <b>상세 페이지</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/85058d60-f084-451a-a093-28126bee970a">
      </td>
    </tr>
  </table>
</details>

<details>
  <summary><b>벼룩시장 화면</b></summary>
  <br>
  <table>
    <tr>
      <td align=center>
        <b>벼룩시장 화면</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/183057e3-d0d8-4b07-8659-0667742952a6">
      </td>
    </tr>
    <tr>
      <td align=center>
        <b>글 작성</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/c0d5ca3a-c875-4dbc-ad50-fc4f766ca434">
      </td>
    </tr>
    <tr>
      <td align=center>
        <b>상세 페이지</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/c59914d9-8152-4e1c-86ce-df514264d429">
      </td>
    </tr>
  </table>
</details>

---

## 담당 서브 시스템 구현 기능

#### 1\. 메인화면 구성

> 자동 Swiper 를 사용하여 레시피, 커뮤니티, 벼룩시장을 이미지로 소개. 클릭 시 해당 링크 이동.

<table>
    <tr>
      <td align=center>
        <b>메인화면</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/4be86494-d839-4c6d-a7f7-ac5c3b9ed0e4" width="500" height="280">
      </td>
    </tr>
  </table>

#### 2\. 회원가입 기능

> 회원가입 시 이메일 중복 체크, 닉네임 중복 체크 기능을 하는 API 사용. 비밀번호 일치 확인 로직 사용.

<details>
  <summary>API 코드 자세히 보기</summary> 
    <div markdown="1">

```java
//회원가입 중복 이메일 체크 로직 (API)
    @PostMapping("/duplicatedNickNameCheck")
    public ResponseEntity<?> duplicatedNickNameCheck(@RequestBody MemberDto memberDto) {
        int result = memberService.duplicatedNickNameCheck(memberDto);
        HashMap<String,String> resultMap = new HashMap<>();

        //중복 회원이 있을 경우
        if(result == 1){
            resultMap.put("status","500");
            resultMap.put("message","이미 가입된 닉네임이 존재합니다!");
        }
        //중복 회원이 없을 경우
        else {
            resultMap.put("status","200");
            resultMap.put("message","사용 가능한 닉네임 입니다.");
        }
```

</details>

<table>
    <tr>
      <td align=center>
        <b>메인화면</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/2260a860-3aa2-428d-90ba-a5a1c81d10b1" width="350" height="500">
      </td>
    </tr>
  </table>

#### 3\. 로그인/로그아웃 기능

> 세션 쿠키에 대한 이해를 통해 로그인을 해야 등록기능을 사용할 수 있도록 구현.

<table>
    <tr>
      <td align=center>
        <b>로그인/로그아웃 기능</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/cc0e799f-198a-48e5-b1b4-0b0912e93580" width="500" height="280">
      </td>
    </tr>
  </table>

#### 4\. Custom Annotation + Custom Exception을 사용한 로그인 리턴

> @ControllerAdvice와 @ExceptionHandler를 사용한 전역 예외 처리기를 정의.

<details>
  <summary>관련 코드와 설명 자세히 보기</summary> 
    <div markdown="1">

```java
package semi.controller.advice;

import com.mysql.cj.util.StringUtils;
import org.springframework.web.context.request.RequestAttributes;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;
import semi.customException.NotLoggedInException;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

@ControllerAdvice
public class GlobalExceptionHandler  {
    @ExceptionHandler(semi.customException.NotLoggedInException.class)
    public String handleNotLoggedInException(NotLoggedInException ex, HttpSession httpSession) {
        httpSession.setAttribute("redirectUrl", getRequestUri());

        return "redirect:/member/login";
    }

    private String getRequestUri() {
        RequestAttributes requestAttributes = RequestContextHolder.currentRequestAttributes();
        HttpServletRequest request = ((ServletRequestAttributes) requestAttributes).getRequest();

        String requestUri = request.getRequestURI();
        String contextPath = request.getContextPath();

        if (!StringUtils.isNullOrEmpty(contextPath)) {
            return requestUri.substring(contextPath.length());
        }
        else {
            return requestUri;
        }
    }
}

```
1. @ControllerAdvice와 @ExceptionHandler 부분
이 부분은 이전 설명과 동일하게 전역 예외 처리기를 설정합니다.
@ExceptionHandler(semi.customException.NotLoggedInException.class)은 로그인되지 않은 상태에서 발생하는 NotLoggedInException을 처리하는 역할을 하며, 로그인 페이지로 리다이렉트하는 방식으로 예외를 처리합니다.
예외 발생 시, 사용자가 방문하려던 페이지의 URL을 세션에 저장하고, 나중에 사용자가 로그인한 후 원래 가려던 페이지로 다시 이동시키는 로직입니다.

2. getRequestUri() 메서드 분석
이 메서드는 현재 요청된 URI를 가져오는 역할을 합니다. 이를 통해 사용자가 로그인하지 않은 상태에서 어떤 페이지에 접근했는지를 확인할 수 있습니다.

- 1) RequestAttributes requestAttributes = RequestContextHolder.currentRequestAttributes();
Spring의 RequestContextHolder를 사용하여 현재 요청과 관련된 속성을 가져옵니다. 이를 통해 현재 HTTP 요청 객체에 접근할 수 있게 됩니다.
- 2) HttpServletRequest request = ((ServletRequestAttributes) requestAttributes).getRequest();
ServletRequestAttributes 객체로 캐스팅한 후, HttpServletRequest 객체를 얻습니다. 이 객체는 현재 HTTP 요청에 대한 정보를 담고 있으며, 이를 통해 URI를 얻을 수 있습니다.
- 3) String requestUri = request.getRequestURI();
getRequestURI()는 현재 요청된 URI 경로를 반환합니다. 예를 들어, /member/profile 같은 URL 경로를 얻을 수 있습니다.
- 4) String contextPath = request.getContextPath();
getContextPath()는 애플리케이션의 컨텍스트 경로를 반환합니다. 예를 들어, 애플리케이션이 /app이라는 경로에서 실행 중이면 /app이 컨텍스트 경로가 됩니다.
- 5) if (!StringUtils.isNullOrEmpty(contextPath)) { ... }
contextPath가 빈 문자열이 아니거나 null이 아니면, requestUri에서 컨텍스트 경로를 제거한 후 반환합니다.
예를 들어, requestUri가 /app/member/profile이고 contextPath가 /app인 경우, 이 메서드는 /member/profile을 반환합니다.
contextPath가 없을 경우, 즉, 루트에서 실행 중이면 requestUri를 그대로 반환합니다.

```java
package ArgumentResolver;

import annotation.Login;
import org.springframework.core.MethodParameter;
import org.springframework.stereotype.Component;
import org.springframework.web.bind.support.WebDataBinderFactory;
import org.springframework.web.context.request.NativeWebRequest;
import org.springframework.web.method.support.HandlerMethodArgumentResolver;
import org.springframework.web.method.support.ModelAndViewContainer;
import semi.customException.NotLoggedInException;
import semi.dto.MemberDto;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import static semi.config.MemberConstants.LOGIN_MEMBER_DTO;

@Component
public class LoginMemberArgumentResolver implements HandlerMethodArgumentResolver {
    @Override
    public boolean supportsParameter(MethodParameter methodParameter) {
        boolean hasLoginAnnotation = methodParameter.hasParameterAnnotation(Login.class);
        boolean hasMemberType = MemberDto.class.isAssignableFrom(methodParameter.getParameterType());
        return hasLoginAnnotation && hasMemberType;
    }

    @Override
    public Object resolveArgument(MethodParameter methodParameter, ModelAndViewContainer modelAndViewContainer, NativeWebRequest nativeWebRequest, WebDataBinderFactory webDataBinderFactory) throws Exception {
        HttpServletRequest request = (HttpServletRequest) nativeWebRequest.getNativeRequest();
        HttpSession session = request.getSession(false);
        if (session == null) throw new NotLoggedInException();

        Object loginSession = session.getAttribute(LOGIN_MEMBER_DTO);
        if (loginSession == null) throw new NotLoggedInException();

        return session.getAttribute(LOGIN_MEMBER_DTO);
    }
}
```
1. supportsParameter(MethodParameter methodParameter)
- 역할: 이 메서드는 주어진 메서드 파라미터가 처리 가능한 파라미터인지를 확인합니다.
- hasLoginAnnotation: 파라미터에 @Login 어노테이션이 붙어 있는지 확인합니다. 이 어노테이션이 붙은 파라미터만 이 resolver가 처리합니다.
- hasMemberType: 파라미터 타입이 MemberDto 클래스 또는 그 하위 클래스인지 확인합니다. 즉, MemberDto 타입의 객체만 처리 대상으로 합니다.
- 결과: 두 조건이 모두 참이면 true를 반환하여 해당 파라미터를 처리할 수 있음을 나타냅니다.

2. resolveArgument(...)
- 역할: 이 메서드는 실제로 메서드 파라미터에 값을 바인딩합니다. @Login 어노테이션이 붙은 MemberDto 파라미터에 세션 정보를 설정하는 역할을 합니다.

- 흐름:

  - HttpServletRequest request = (HttpServletRequest) nativeWebRequest.getNativeRequest();
  NativeWebRequest에서 HTTP 요청 객체를 가져옵니다.

  - HttpSession session = request.getSession(false);
  현재 요청에 대한 세션을 가져옵니다. false로 설정했기 때문에 세션이 없으면 새로 생성하지 않고 null을 반환합니다.
  세션이 존재하지 않으면 NotLoggedInException을 발생시킵니다.

  - Object loginSession = session.getAttribute(LOGIN_MEMBER_DTO);
  세션에서 LOGIN_MEMBER_DTO라는 이름으로 저장된 객체를 가져옵니다. 이는 아마도 로그인된 사용자의 정보를 담고 있는 MemberDto 객체일 것입니다.
  세션에 해당 정보가 없으면 NotLoggedInException을 발생시킵니다.

  - return session.getAttribute(LOGIN_MEMBER_DTO);
  세션에서 가져온 LOGIN_MEMBER_DTO 객체를 반환하여, 메서드 파라미터로 자동으로 전달되도록 합니다.

</details>

<table>
    <tr>
      <td align=center>
        <b>메인화면</b>
      </td>
    </tr>
    <tr>
      <td align=center>
        <img src="https://github.com/user-attachments/assets/b4824e69-c415-455a-bf71-0b2838ce06dc" width="500" height="280">
      </td>
    </tr>
  </table>

---

## 프로젝트 소감 및 의의

- 개인 Mini 프로젝트만 구현하다가 처음으로 해본 팀 프로젝트였습니다.
차근차근 기초부터 쌓는다는 마음가짐으로 전반적인 화면 구성과 로그인을 담당하였습니다.

- 소통과 피드백을 통해 팀원들과 의견을 조율하는 것은 서로의 지식을 더욱 가치있게 만들어주는 계기가 되어 좋은 결과를 이끌어낼 수 있었습니다.

- 구현 중 발생한 오류와 실수를 기록하고, 이를 통해 문제를 보완하는 것의 중요성을 알게 되었습니다. 이러한 과정을 통해 한층 더 성장하여 앞으로의 프로젝트에서 더 나은 결과물을 만들고 싶습니다.
